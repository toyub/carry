<div class="main_top">
        <h2>订货</h2>
        <span class="add_span">+</span>
      </div>
      <div class="details">
        <%= render partial: 'shortcuts' -%>
        <div class="details_nav">
          <ul>
            <li class="bg-color-fff"><a href="gongyingshangxinxishow.html" class="width-90">供应商信息</a></li>
            <li><a href="javascript:void(0);" onclick='alert("请先保存供应商信息")' class="width-90">订货</a></li>
            <li><a href="javascript:void(0);" onclick='alert("请先保存供应商信息")' class="width-90">记录</a></li>
            <li><a href="javascript:void(0);" onclick='alert("请先保存供应商信息")' class="width-90">评估</a></li>
          </ul>
        </div>
        <div class="details_nav_second">
          <ul class="goods_nav">
            <li><a href="#" class="width-90">▲上一件商品</a></li>
            <li><a href="#" class="width-90">▼下一件商品</a></li>
            <li ><a href="#" class="width-90">返回列表</a></li>
          </ul>
        </div>
        <%= render partial: 'form' -%>
      </div>


      <% content_for :javascripts do %>
         <script>
            jQuery(function(country_code){
              var fill_state_select = function (country_code){
                var url =`/ajax/geo/${country_code}/states.json`;
                $.get(url, function(data){
                  var x = data.map(function(state){
                    return `<option value=${state.code}>${state.name}</option>`;
                  }).join("");
                  $("[name='store_supplier[state_code]']").html(x);
                  if(data[0]){
                    fill_city_select(country_code, data[0].code);
                  }
                });
              };

              var fill_city_select  = function(country_code, state_code){
                var url = `/ajax/geo/${country_code}/states/${state_code}/cities.json`;
                $.get(url, function(data){
                  var x = data.map(function(state){
                    return `<option value=${state.code}>${state.name}</option>`;
                  }).join("");
                  $("[name='store_supplier[city_code]']").html(x);
                });
              };

              var fill_sub_category_select = function(root_category_id){
                var url = `/kucun/material_categories/${root_category_id}/sub_categories`;
                $.get(url, function(data){
                  var x = data.material_categories.map(function(category){
                    return `<option value=${category.id}>${category.name}</option>`;
                  }).join("");
                  $('[name="store_supplier[category_id]"]').html(x);
                });
              }

              $('select').on('change', function(){
                switch(this.name){
                  case 'store_supplier[country_code]':
                    $("[name='store_supplier[state_code]']").html("");
                    $("[name='store_supplier[city_code]']").html("");
                    fill_state_select(this.value);
                    break;
                  case 'store_supplier[state_code]':
                    $("[name='store_supplier[city_code]']").html("");
                    var country_code = $("[name='store_supplier[country_code]']").val();
                    fill_city_select(country_code, this.value);
                    break;
                  case 'store_supplier[city_code]':
                    break;
                  case 'store_supplier[root_category_id]':
                    $("[name='store_supplier[category_id]']").html('');
                    fill_sub_category_select(this.value);
                    break;
                  default:
                    break;
                }
              });
            });
         </script>
      <% end %>
