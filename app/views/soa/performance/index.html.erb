<div class="main_top">
  <h2>绩效提成</h2>
  <%= @staffs.count %>
</div>

<div class="details">

  <div class="list_table">

    <div class="search_nav">
      <%= form_tag("/soa/performance/search", method: :get) do -%>
        <div class="date">
          <span>日期</span>
          <%= date_select(
            "", :date,
            { start_year: 2000, use_short_month: true, discard_day: true, :default => @search_date},
            {:include_blank => @search_date.nil?, class: "width-100" }
          )
          %>
        </div>

        <div class="department">
          <span>部门</span>
          <select name="store_department_id" class="width-100">
            <%= options_from_collection_for_select(@departments, 'id', 'name', params[:store_department_id]) %>
          </select>
        </div>

        <div class="position">
          <span>职务</span>
          <select name="store_position_id" class="width-100">
            <%= options_from_collection_for_select(@positions, 'id', 'name', params[:store_position_id]) %>
          </select>
        </div>

        <div class="keywords margin-right-50">
          <span>关键字</span>
          <%= text_field_tag :keyword, params[:keyword], class: "width-150" %>
          <%= submit_tag "查询", class: "btn query_btn"%>
        </div>


      <div class="float-right">
        <a href="#" class="btn print_btn">打印</a>
        <a href="#" class="btn export_btn">导出</a>

        <select class="width-100 margin-left-10">
          <option>显示5行</option>
          <option>全部显示</option>
        </select>
      <% end %>
      </div>
    </div>


    <table class="commission_list">
      <thead>
        <tr>
          <th>#</th>
          <th>姓名</th>
          <th>员工编号</th>
          <th>部门</th>
          <th>职务</th>
          <th>订单数量</th>
          <th>商品数量</th>
          <th>商品金额</th>
          <th>项目数量</th>
          <th>项目金额</th>
          <th>成交金额</th>
          <th>提成金额</th>
          <th>查看</th>
        </tr>
      </thead>

      <tbody>
        <% @staffs.each do |staff| %>
        <tr>
          <td class="sequence_num"><%= staff.id %></td>
          <td><%= staff.screen_name %></td>
          <td><%= staff.numero %></td>
          <td><%= staff.store_department.try(:name) %></td>
          <td><%= staff.store_position.try(:name) %></td>
          <td>3,500</td>
          <td>1,300</td>
          <td>0.00</td>
          <td>150.00</td>
          <td>220.00</td>
          <td>0.00</td>
          <td>180.00</td>
          <td><a href="../yuangongliebiao/jixiaoticheng.html"><i class="ico ico-edit font-14"></i></a></td>
        </tr>
      <% end %>
      </tbody>

      <tfoot>
        <tr>
          <td colspan="13" class="text-align-right">
            <span class="width-80">成交总金额：</span> <span class="width-110">123.366.00</span>
            <span class="width-80">提成总金额：</span> <span class="width-110">2,765.00</span>
          </td>
        </tr>
      </tfoot>
    </table>

  </div>
</div>

<script type="text/javascript" charset="utf-8">
  jQuery(function($){
    $('.department').on('change', '[name="store_department_id"]', function(){
      $.get('/api/store_departments/'+this.value+'/store_positions.json', function(positions){
        var options = positions.map(function(position){
          return '<option value="'+ position.id +'">'+ position.name +'</option>'
        });
        $('[name="store_position_id"]').html(options.join(''));
      });
    })
  });
</script>
