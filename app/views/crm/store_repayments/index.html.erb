<% content_for :pre_assets do %>
  <%= stylesheet_link_tag "/stylesheets/kehu.css" %>
<% end %>
<%= render '/crm/common/page_head' %>

<div class="details">

<%= render 'crm/common/customer_nav' %>

  <div class="details_content">
    <div class="panel_tab">
      <ul class="tab_items">
        <li><a href="javascript:void(0)" class="width-90 active tab_item">未清挂账</a></li>
        <li><a href="yiqing.html" class="width-90 tab_item">已清挂账</a></li>
        <li><a href="all.html" class="width-90 tab_item">所有挂账</a></li>
      </ul>
    </div>

    <div class="content customer_account">
      <div class="panel_query">
        <%= search_form_for @q , url: crm_store_customer_store_repayments_path(@customer), class: 'float-left' do  -%>
          <%= render 'search_form' %>
        <% end %>
    <%= form_tag url: crm_store_customer_store_repayments_path(@customer), method: 'POST', class: 'float-right' do %>
        <div class="query_item float-right">
          <label class="margin-right-10">回款合计</label>
          <input type="text" class="height-29 margin-right-10" name="repayment[total]" value="">
          <input type="submit" class="btn button_confirm width-86 height-29" id="submit" value="确认回款">
        </div>
      </div>

      <div class="orders">
        <% @orders.each do |order| %>
        <div class="order_item slide_up" id="js-order-<%= order.id%>" >
          <div class="abstract">
            <input type="checkbox" name="repayment[orders][]" value="<%= order.id%>" >
            <span class="item_control width-260  margin-left-19">订单号： <%= order.numero %> </span>
            <span class="item_control width-200">下单时间：<%= order.created_at.strftime("%Y.%m.%d") %></span>
            <span class="item_control width-200">下单人：<%= order.creator.full_name %></span>
            <span class="item_control width-200">订单金额：<%= order.amount_total %>0</span>
            <span class="item_control width-320">挂账余额： <%= order.repayment_remaining %> </span>
            <i class="fa fa-chevron-down cursor-pointer js-slide-down" data-id="<%= order.id%>" ></i>
            <i class="fa fa-chevron-up cursor-pointer js-slide-up" data-id="<%= order.id%>" ></i>
          </div>

          <table class="detail" id="js-detail-<%= order.id%>" >
            <thead>
              <tr>
                <th>项目&amp;产品</th>
                <th>单价</th>
                <th>数量</th>
                <th>优惠</th>
                <th>小计</th>
              </tr>
            </thead>
            <tbody>
              <% order.items.each do |item| %>
                <tr>
                  <td> <%= item.orderable.name %> </td>
                  <td> <%= item.price %> </td>
                  <td> <%= item.quantity %> </td>
                  <td> <%= item.discount %> </td>
                  <td> <%= item.amount %> </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <% end %>
      </div>

      <p class="btn_group text-align-center">
        <a href="javascript:void(0)" class="font-14 fa fa-arrow-down show_more">点击加载更多</a>
      </p>
    <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
jQuery(function($){
  $("i.fa.fa-chevron-down.cursor-pointer.js-slide-down").on("click",function(){
    $("div#js-order-"+$(this).data("id")).removeClass("slide_up").addClass("slide_down");
  });

  $("i.fa.fa-chevron-up.cursor-pointer.js-slide-up").on("click",function(){
    $("div#js-order-"+$(this).data("id")).removeClass("slide_down").addClass("slide_up");
  });

  $("input#submit").on("click",function(){
      if($("input:checked").length == 0){
        alert("请选择对应的订单!");
        return false;
      };
  });

});

</script>
